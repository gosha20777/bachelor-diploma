\subsubsection{Запуск моделей глубокого обучения в .NET}

Как говорилось в разделе \ref{sect-7-1}, для высокопроизводительного инференса моделей глубокого обучения требуются низкоуровневые библиотеки. Эти библиотеки спроектированы для разного оборудования и имеют различные интерфейсы взаимодействия (API). Также, зачастую, для возможности использования того или иного оборудования необходима установка различных драйверов (например nVidia CUDA и CuDNN). В добавок, использование нейронных сетей часто требует наличие интерпретатора python и различных python зависимостей (например opencv-python, numpy и т д). Все это требует от пользователя дополнительных знаний и затрудняет установку ПО и использование СНС.

Для решения этой проблемы была разработана система модулей \cite{lib-plugins}. Основная идея заключается в том, что модель поставляется вместе с модулем, включающем в себя весь набор низкоуровневых библиотек, необходимых для работы того, или оного оборудования, а также программный код осуществляющий связку между С\slash С++ методами библиотек и .NET CLI (Common Language Infrastructure). Таким образом программный код C\# способен вызывать соответствующие низкоуровневые методы и осуществлять вычисления на том, или ином устройстве.

В свою очередь каждый модуль предоставляет единообразный интерфейс взаимодействия -- $IObjectDetectionPlugin$. С помощью него, программа может узнать, на каких операционных системах способен работать модуль и с какими устройствами. Модули могут подключаться в программу независимо друг от друга. ПО анализирует платформу, на которой оно запущено, и предлагает установить пользователю модуль, обеспечивающий максимальную производительности на его оборудовании. Например, если у пользователя имеется GPU от nVidia -- программа предложит пользователю использовать модуль с CUDA, CuDNN и TensorRT. Все модули хранятся на удаленном сервере, а пользовательское ПО способно управлять ими по средствам менеджера модулей (система управления модулей схожа с менеджерами пакетов APT, PIP, NuGet).

Классификация платформ запуска моделей глубокого обучения представлены ниже:

\begin{itemize}
    \item Операционные системы:
    \begin{itemize}
        \item Linux
        \item Windows
        \item OSX
    \end{itemize}
    \item Вычислительные устройства:
    \begin{itemize}
        \item CPU
        \item GPU
        \begin{itemize}
            \item nVidia GPU
            \item AMD GPU
        \end{itemize}
        \item Сопроцессоры
        \begin{itemize}
            \item Google Edge TPU
            \item Intel Movidius NPU
        \end{itemize}
    \end{itemize}
\end{itemize}

Для работы с различными вычислительными устройствами используются различные наборы библиотек (так, например, для процессоров Intel и AMD используется oneDNN, для GPU от nVidia -- CUDA, CuDNN и TensorRT, а для GPU от AMD -- ROCm и DirectML). Применение той, или иной библиотеки может зависеть от операционной системы. С учетом этих особенностей мною были использованы следующие варианты конфигураций:

\addimghere{7-2-plotforms-tree}{0.8}{Дерево платформ и библиотек}{7-2-plotforms-tree}

Собранный модуль имеет следующую структуру: в корне модуля лежат .DET Core библиотеки, обеспечивающие вызов низкоуровневых компонентов и предоставляющие программе API для инициализации и вызова модуля, а в каталоге runtimes, находятся платформозависимые низкоуровневые компоненты (рис. \ref{7-2-plugin-tree}).

\addimghere{7-2-plugin-tree}{0.8}{Cтруктура модуля LаcmusRetineNetPlugin.CPU}{7-2-plugin-tree}

Благодаря предложенному подходу, пользователь может легко манипулировать модулями с моделями глубокого обучения в зависимости от его потребностей. Инкапсуляция в модулях низкоуровневых библиотек избавляет пользователя от ручной установки драйверов и компонентов, облегчая использование ПО. В добавок, такая система позволяет обновлять СНС без необходимости обновления самого ПО и его рекомпиляции, что упрощает процесс разработки и поддержки.

Общая схема архитектуры ПО приведена ниже:

\addimghere{7-2-app-arch}{0.8}{J,ofz fh[LacmusApp]}{7-2-app-arch}

Напоследок, хочется отметить, что данное ПО и все его компоненты (включая СНС) имеют открытый исходный код и распространяются свободно под лицензией GNU GPL v3 \cite{lib-lacmus} \cite{lib-lacmus-app}.
