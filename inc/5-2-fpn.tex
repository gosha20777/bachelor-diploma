\subsection{Feature Pyramid Network} \label{sect-5-2}

FPN состоит из нескольких частей (рис. \ref{fpn-arch}): восходящей (bottom-up) и нисходящей (top-down) пирамид, а также боковых соединений (lateral connections). Рассмотрим подробнее каждую часть.

\addimghere{5-2-fpn-arch}{0.8}{Архитектура FPN}{fpn-arch}

Восходящая пирамида -- есть некоторая последовательность светрочных слоев, размерность которых уменьшается. Она  извлекает признаки из входного изображения. В нашем случае это базовая сеть (ResNet50). Стоит отметить, что с ростом уровней пирамиды, увеличивается число информации, содержащиеся в каждом супер-пикселе сверточного слоя (receptive field), но вместе с тем, уменьшается размерность выходного тензора.

Из-за этого факта, bottom-up пирамида обладает уязвимостью -- важные признаки, особенно если объект небольшой, могут потеряться при перекрытии объекта (человек прикрыт травой), так как конечные объекты имеют размер всего в несколько супер-пикселей (рис. \ref{fpn-distribution}). Как следствие, СНС будет работать нестабильно, а количество ошибок 1 и 2 рода возрастет. 

\addimghere{5-2-fpn-distribution}{0.6}{Внутреннее представление человека на одном из верхних уровней FPN}{fpn-distribution}

Некоторые пути решения этой проблемы будут рассмотрены в следующих разделах, а сейчас сконцентрируемся на устройстве FPN.

Нисходящая пирамида -- напротив, представляет собой последовательность светрочных слоев размерность которых увеличивается по мере спуска сигнала. На каждом шаге размерность карт признаков возрастает в 2 раза, при этом, недостающие признаки выбираются методом ближайших соседей (рис. \ref{fpn-top-down-knn}) \cite{lib-knn}. Начальные уровни top-down пирамиды имеют такую же размерность, что и верхние уровни bottom-up пирамиды, а размеры последних -- наоборот соответствуют первым уровням backbone-сети.

\addimghere{5-2-fpn-top-down-knn}{0.5}{Увеличение размерности признаков методом ближайшего соседа}{fpn-top-down-knn}

В добавок, между пирамидами в FPN существуют и боковые соединения. Благодаря им, признаки соответствующих слоёв складываются поэлементно, а карты из bottom-up пирамиды проходят через свёртку $1 \times 1$ (рис. \ref{fpn-connections}).

\addimghere{5-2-fpn-connections}{0.6}{Устройство боковых соеденений}{fpn-connections}

Уровни нисходящей пирамиды принято обозначать как $P_1, P_2, ..., P_n$, притом каждый $i$ уровень top-down пирамиды соответствует $i$-му уровню bottom-up пирамиды $C_1, C_2, ..., C_n$. Заметим, что количество $P$ уровней может быть меньше количества уровней $C$. Тогда, уровни нисходящей пирамиды могут быть сдвинуты на некоторый шаг. Так, оригинальная FPN имеет конфигурацию с пятью уровнями $P_3...P_7$. На изображении ниже приведен пример FPN сети с конфигурацией $P_3...P_5$:

\addimghere{5-2-fpn-p3-p5}{0.8}{Архитектура FPN c $P_3...P_5$ уровнями}{5-2-fpn-p3-p5}